<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🎵 لعبة الإيموجي</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background: linear-gradient(135deg, #f6d365, #fda085);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      height: 100vh;
      margin: 0;
      padding: 10px;
      user-select: none;
    }
    h1 {
      margin: 10px 0;
      color: #fff;
      text-shadow: 1px 1px 3px #00000030;
    }
    #startScreen, #gameUI {
      width: 100%;
      max-width: 500px;
    }
    #startScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    #startBtn, #retryBtn {
      padding: 15px 30px;
      font-size: 1.5rem;
      background-color: #55efc4;
      border: none;
      border-radius: 14px;
      cursor: pointer;
      transition: 0.3s;
      margin-top: 20px;
    }
    #startBtn:hover, #retryBtn:hover {
      background-color: #00cec9;
      color: white;
    }
    #gameUI {
      display: none;
      flex-direction: column;
      align-items: center;
    }
    #task {
      font-size: 1.5rem;
      background: #ffffff40;
      padding: 10px 20px;
      border-radius: 15px;
      margin: 10px;
      color: white;
    }
    #emojis {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: center;
      margin-bottom: 20px;
    }
    .emoji-btn {
      font-size: 3rem;
      padding: 20px;
      border: none;
      border-radius: 14px;
      background: #ffeaa7;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: 0.2s;
    }
    .emoji-btn:hover {
      background: #fab1a0;
    }
    .emoji-btn:active {
      transform: scale(0.9);
    }
    .emoji-move {
      animation: wiggle 0.6s ease-in-out infinite alternate;
    }
    @keyframes wiggle {
      0% { transform: translateX(0); }
      100% { transform: translateX(5px); }
    }
    #info {
      font-size: 1.2rem;
      background: #dfe6e9;
      padding: 10px 20px;
      border-radius: 10px;
      color: #2d3436;
      margin-bottom: 10px;
    }
    #extraMessage {
      font-size: 1rem;
      color: white;
      font-weight: bold;
      margin-top: 5px;
      display: none;
    }
    #result {
      font-size: 1.2rem;
      color: #2d3436;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <div id="startScreen">
    <h1>🎵 اضغط الإيموجي الصحيح!</h1>
    <button id="startBtn">ابدأ اللعبة</button>
  </div>

  <div id="gameUI">
    <h1>المستوى <span id="level">1</span></h1>
    <div id="task">اضغط على: <span id="targetEmoji"></span></div>
    <div id="emojis"></div>
    <div id="info">⏱ الوقت: <span id="timer">5</span> | ⭐ النقاط: <span id="score">0</span></div>
    <div id="extraMessage">✨ تم إضافة حركة الإيموجيز!</div>
    <div id="result"></div>
    <button id="retryBtn">🔄 إعادة المحاولة</button>
  </div>

  <audio id="winSound" src="win.mp3" preload="auto"></audio>
  <audio id="loseSound" src="lose.mp3" preload="auto"></audio>

<script defer>
  const emojiGroups = {
    easy: ['😀','😂','😎','👻','🍕','⚽','🎮','🚀','🌈','🍩'],
    medium: ['🐶','🐕','🐩','🐾','🐱','🐈','😺','🐵','🐸','🐷'],
    hard: ['🌝','🌞','🌚','🌕','🌙','🍎','🍏','🍐','👨‍🦰','👨‍🦱','👨‍🦲','👨‍🦳']
  };

  let target = '', timeLeft = 5, score = 0, level = 1, timerInterval;

  const startScreen = document.getElementById('startScreen');
  const gameUI = document.getElementById('gameUI');
  const startBtn = document.getElementById('startBtn');
  const levelSpan = document.getElementById('level');
  const targetEmojiSpan = document.getElementById('targetEmoji');
  const emojisDiv = document.getElementById('emojis');
  const timerSpan = document.getElementById('timer');
  const scoreSpan = document.getElementById('score');
  const resultDiv = document.getElementById('result');
  const retryBtn = document.getElementById('retryBtn');
  const extraMessage = document.getElementById('extraMessage');

  const winSound = document.getElementById('winSound');
  const loseSound = document.getElementById('loseSound');

  startBtn.addEventListener('click', () => {
    winSound.play().then(() => winSound.pause());
    loseSound.play().then(() => loseSound.pause());

    startScreen.style.display = 'none';
    gameUI.style.display = 'flex';
    score = 0;
    level = 1;
    scoreSpan.textContent = score;
    levelSpan.textContent = level;
    startRound();
  });

  retryBtn.addEventListener('click', () => {
    score = 0;
    level = 1;
    scoreSpan.textContent = score;
    levelSpan.textContent = level;
    startRound();
  });

  function getEmojiPool() {
    if (level < 3) return emojiGroups.easy;
    if (level < 5) return emojiGroups.easy.concat(emojiGroups.medium);
    return emojiGroups.easy.concat(emojiGroups.medium, emojiGroups.hard);
  }

  function getNumberOfChoices() {
    return 4 + level; // لا حد أقصى
  }

  function getRandomEmojis(exclude, count) {
    let pool = getEmojiPool().filter(e => e !== exclude);
    let selected = [];
    while (selected.length < count - 1) {
      let rand = pool[Math.floor(Math.random() * pool.length)];
      if (!selected.includes(rand)) selected.push(rand);
    }
    selected.push(exclude);
    return shuffle(selected);
  }

  function shuffle(arr) {
    for (let i = arr.length -1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function disableAllButtons() {
    const buttons = document.querySelectorAll('.emoji-btn');
    buttons.forEach(btn => {
      btn.disabled = true;
      btn.style.opacity = '0.5';
      btn.style.cursor = 'not-allowed';
    });
  }

  function startRound() {
    retryBtn.style.display = 'none';
    resultDiv.textContent = '';
    timeLeft = 5;
    timerSpan.textContent = timeLeft;

    extraMessage.style.display = (level >= 15 && level <= 20) ? 'block' : 'none';

    let emojiPool = getEmojiPool();
    target = emojiPool[Math.floor(Math.random() * emojiPool.length)];
    targetEmojiSpan.textContent = target;

    emojisDiv.innerHTML = '';
    let count = getNumberOfChoices();
    let choices = getRandomEmojis(target, count);
    let size = 4.5 - (count - 4) * 0.25;
    size = Math.max(size, 1.5);

    choices.forEach(e => {
      const btn = document.createElement('button');
      btn.className = 'emoji-btn';
      if (level >= 15 && level <= 20) {
        btn.classList.add('emoji-move');
      }
      btn.textContent = e;
      btn.style.fontSize = `${size}rem`;
      btn.style.padding = `${10 + (size * 2)}px`;
      btn.addEventListener('click', () => {
        if (e === target) {
          winSound.currentTime = 0;
          winSound.play();
          score++;
          scoreSpan.textContent = score;
          resultDiv.style.color = '#2ecc71';
          resultDiv.textContent = '👏 صحيح!';
          clearInterval(timerInterval);
          if (score % 3 === 0) {
            level++;
            levelSpan.textContent = level;
          }
          setTimeout(startRound, 800);
        } else {
          loseSound.currentTime = 0;
          loseSound.play();
          resultDiv.style.color = '#d63031';
          resultDiv.textContent = '❌ خطأ!';
          clearInterval(timerInterval);
          retryBtn.style.display = 'inline-block';
          disableAllButtons();
        }
      });
      emojisDiv.appendChild(btn);
    });

    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
      timeLeft--;
      timerSpan.textContent = timeLeft;
      if (timeLeft === 0) {
        clearInterval(timerInterval);
        loseSound.currentTime = 0;
        loseSound.play();
        resultDiv.style.color = '#d63031';
        resultDiv.textContent = `⏰ انتهى الوقت! كانت: ${target}`;
        retryBtn.style.display = 'inline-block';
        disableAllButtons();
      }
    }, 1000);
  }
</script>

</body>
</html>